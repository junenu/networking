# EVPNとは

## 始めに

EVPN（Ethernet VPN）は、異なる地理的場所にあるイーサネットネットワークを相互接続するための規格で、その基本的な目的は、分散したデータセンターやキャンパスネットワーク間で一貫したレイヤ2サービスを提供することです。これにより、ユーザは異なる地域にあるデータセンター間で仮想マシン（VM）やワークロードを自由に移動させることができます。

## EVPNとは

EVPNは、BGP（Border Gateway Protocol）を使用してレイヤ2情報（たとえばMACアドレス）を広報し、それを基にトンネルを形成します。EVPNは多彩なトポロジをサポートしており、これにはポイントツーポイント接続、ポイントツーマルチポイント接続、およびマルチポイントツーマルチポイント接続が含まれます。また、EVPNはMPLS（Multi-Protocol Label Switching）やVXLAN（Virtual Extensible LAN）などの異なるデータプレーン技術を利用することができます。

EVPNは、既存のレイヤ2VPNソリューション（例えば、VPLS）に比べて、いくつかの重要な強みを持っています。これには、高度なマルチテナンシー、効率的なマルチキャスト配信、VMの移動に対する動的な対応、そしてARPスプーフィングやIP/MACスプーフ

ングなどのセキュリティ問題への強力な防御が含まれます。

## まとめ

EVPNは、広域ネットワークプロトコルを使用してレイヤ2イーサネットトラフィックを仮想プライベートネットワークとして運搬する技術です。EVPNの技術には、MPLSとVXLANを介したイーサネットが含まれます。

## 用語解説

以下に、EVPNに関連する主要な用語の解説を行います。

- **EVPN（Ethernet VPN）**: 広域ネットワークプロトコルを使用してレイヤ2イーサネットトラフィックを仮想プライベートネットワークとして運搬する技術。この技術には、MPLSとVXLANを介したイーサネットが含まれる。

- **BGP（Border Gateway Protocol）**: インターネット上でデータをルーティングするためのプロトコル。EVPNでは、BGPはレイヤ2情報を広報し、これを基にトンネルを形成します。

- **MPLS（Multi-Protocol Label Switching）**: データパケットを送信するための高性能ネットワーク技術。EVPNはMPLSを使用してデータを転送します。

- **VXLAN（Virtual Extensible LAN）**: ネットワーク内の仮想マシンを隔離し、それらを一つのレイヤ2サブネット内で動作させるためのネットワーク仮想化技術。EVPNはVXLANを利用することも可能です。

- **ARPスプーフィング**: ネットワーク内で不正なARP（Address Resolution Protocol）応答を用いて、他のホストのIPアドレスを偽装する攻撃手法。EVPNはこのような攻撃からネットワークを保護します。


## ルートタイプ

EVPNでは、BGPを使用して情報を交換し、ルート広報を行います。このとき、EVPNで使用されるルートタイプは主に5つ存在します。それぞれのルートタイプは特定の目的を持ち、異なる情報を広報します。

1. **EVPN Ethernet Auto-Discovery (EAD) Route (Type 1)**: EADルートは、同じEVPNインスタンスのPE（Provider Edge）ルータ間で、マルチホーミング情報を交換するために使用されます。これにより、PEルータは他のPEルータが同じEVPNインスタンスに参加していることを認識できます。また、EADルートは、リンクの冗長性と負荷分散をサポートするためにも重要です。

2. **MAC/IP Advertisement Route (Type 2)**: MAC/IP Advertisementルートは、PEルータが保持するMACアドレスと、そのMACアドレスに対応するIPアドレスの情報を他のPEルータに通知するために使用されます。これにより、EVPNインスタンス全体でMACアドレスとIPアドレスの学習が可能になります。

3. **Inclusive Multicast Ethernet Tag Route (Type 3)**: Inclusive Multicast Ethernet Tagルートは、同じEVPNインスタンスに属する全PEルータに対して、ブロードキャスト、未知のユニキャスト、マルチキャスト（BUM）トラフィックを転送するためのデフォルトのマルチキャスト配信の設定を広報します。

4. **Ethernet Segment Route (Type 4)**: Ethernet Segmentルートは、特定のEVPNインスタンスに属するマルチホーミングPEルータ間で使用されます。このルートは、主にバックアップパスの設定と、特定のイーサネットセグメントに対する負荷分散の設定を行います。

5. **IP Prefix Route (Type 5)**: IP Prefixルートは、一部の高度なユースケースで使用され、主にレイヤ3の接続性を提供します。このルートタイプを使用すると、PEルータは特定のIPプレフィックス（IPサブネット）についての情報を広報できます。これにより、EVPNネットワークは、レイヤ2接続性だけでなく、レイヤ3接続性もサポートすることが可能になります。

これらのルートタイプは、EVPNネットワークが正しく機能し、エンドユーザーに対して一貫したレイヤ2およびレイヤ3の接続性を提供するために必要となります。


## 参考文献
[Arista データセンターでのルーティングプロトコル](https://www.janog.gr.jp/meeting/janog41/application/files/5515/1651/9605/janog41-dcrtg-shtsuchi-01.pdf)